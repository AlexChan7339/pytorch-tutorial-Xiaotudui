# 26-网络模型的保存与读取

在pycharm项目下新建python脚本model_save

```python
import torchvision, torch
vgg16 = torchvision.models.vgg16(pretrained=False)
# 保存方式1
torch.save(vgg16, "vgg16_method1.pth")
# "vgg16_method1.pth":保存路径
# 此时不仅保存了网络模型，也保存了模型参数

# 加载模型方式1
model = torch.load("vgg16_method1.pth")
print(mdoel)

# 保存方式2:模型参数（官方推荐）
torch.save(vgg16.state_dict(), "vgg16_method2.pth")# 将vgg的状态保存为字典格式
# 加载模型方式2
model = torch.load("vgg16_method2.pth")
print(model)
```

方式2打印的是字典形式

![image-20251030214603203](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105291.png)

> 查看模型文件大小：
>
> 在terminal中cd 到指定的文件夹，然后输入`ls -all`(mac),`dir`(win)

```python
# 将字典形式恢复成网络结构
vgg16 = torchvision.models.vgg16(pretrained=False)
vgg16.load_state_dict(torch.load("vgg16_method2.pth"))
# 通过字典形式获取vgg16的网络结构
print(vgg16)
```

---

```python
# 陷阱（写在另一个python文件model_save2里）
from torch import nn
import torch

class Tudui(nn.Module):
    def __init__(self):
        super(Tudui, self).__init__()
        self.conv1 = nn.Conv2d(3, 64, kernel_size=3)
        
    def forward(self, x):
        x = self.conv1(x)
        return x

tudui = Tudui()
torch.save(tudui, "tudui_method1.pth")     
        
```

```python
# 写在model_save脚本里
model = torch.load("tudui_method1.pth")
print(model)
#会报错: Can't get attribute 'Tudui' on <module '__main__'from ....

# 此时需要将上面创建的类放在上面，但是不需要初始化实例
```

```python
from torch import nn

class Tudui(nn.Module):
    def __init__(self):
        super(Tudui, self).__init__()
        self.conv1 = nn.Conv2d(3, 64, kernel_size=3)
        
    def forward(self, x):
        x = self.conv1(x)
        return x

model = troch.load("tudui_method1.pth")
print(model)
# 或者from model_save2 impor *
```

```python
from torch import nn
from model_save2 impor *

model = troch.load("tudui_method1.pth")
print(model)
# 或者import Tuidui
```

