# 25-现有网络模型的使用及修改

## VGG

常用的是VGG16(ImagNet:15000张图片，1000类的分类数据集；)，VGG19：

- pretrained：如果为True，模型参数在ImageNet数据集中已经训练好了，已经取得很好的效果；如果为False，参数值为初始化参数，没有在数据集上进行训练
- progress：是否生成进度条

![image-20251030205149481](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105892.png)

![image-20251030205231157](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105815.png)

> 需要按住scipy包

在pycharm项目下新建python脚本model_pretrained

> 在terminal中激活虚拟环境，检验是否安装包：`pip list`，如果没有，安装scipy：`pip install scipy`

```python
train_data = torchvision.datasets.ImageNet("./dataset/ImageNet", split="train", download=True, transform=torchvision.transform.ToTensor())# 需要训练集
# 会报错：需要手动安装
# 这个数据集有149Gib
```

```python
# 加载网络结构
import torchvision
vgg16_false = torchvision.models.vgg16(pretrained=False)
# 记载网络模型吃的参数是初始化的
vgg16_true = torchvision.models.vgg16(pretrained=True)
# 从网络中下载具体参数：池化层的具体参数已经在数据集上训练好的
# 断点调试：点击vgg16_true--features--Protected Attributes--_modules--'0'--weight
```

vgg16_true的网络结构

![image-20251030210451103](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105861.png)

vgg16_false的网络结构

![image-20251030210613546](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105877.png)

>  两者差别不大

```python
print(vgg16_true)
# VGG16：1000分类的分类的分类模型
```

![image-20251030210745436](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105931.png)

![image-20251030211231071](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105835.png)

```python
train_data = torchvision.datasets.CIFAR10("./dataset/CIFAR10", train=True, transform=trochvision.transforms.ToTensor(), download=True)
# CIFAR10是10分类的数据集，需要套VGG16的网络结构，需要将outfeatures修改为10，或者再在后面套一层线性层输出特征数为10, 输入特征数为1000

```

```python
# 利用现有网络进行搭建:将outfeatures修改为10（很多的结构也都是在VGG的后面加上一些其他的层）
from torch import nn
vgg16_true.add_module("add_linear", nn.Linear(1000, 10))
# 此时的线性层是加在classifier的外面，我们需要加在classifier的里面

vgg16_true.classifier.add_module("add_linear", nn.Linear(1000, 10))
```

```python
# 直接修改VGG16的最后一层linear_layer
# 由于vgg16_true已经使用过了，这里使用vgg16_false
vgg16_false.classifier[6] = nn.Linear(4096, 10)
print(vgg16_false)
```

![image-20251030212031547](https://typora3.oss-cn-shanghai.aliyuncs.com/202511062105426.png)